<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="汝还白汝天子，我承人乏，为中国所推，已为帝矣。">
    <meta name="keyword"  content="李永会,李郞小汇,机器学习,移动端,GPU">
    <link rel="shortcut icon" href="/img/ironman-draw.png">
    <!-- Place this tag in your head or just before your close body tag. -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <title>
        
          chapter-01-getting-started - 李郞小汇
        
    </title>

    <link rel="canonical" href="http://www.allonli.com/2016/02/22/chapter-01-getting-started/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS --> 
    <link rel="stylesheet" href="/css/beantech.min.css">
    
    <!-- Pygments Highlight CSS -->
    <link rel="stylesheet" href="/css/highlight.css">

    <link rel="stylesheet" href="/css/widget.css">

    <link rel="stylesheet" href="/css/rocket.css">

    <link rel="stylesheet" href="/css/signature.css">

    <link rel="stylesheet" href="/css/toc.css">

    <!-- Custom Fonts -->
    <!-- <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="https://cdn.staticfile.org/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">


    <!-- Hux Delete, sad but pending in China
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/
    css'>
    -->


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!--allonli add-->
    <style type=text/css>
	.at_img img{max-width:70%;}
    </style>

    <!-- ga & ba script hoook -->
    <script></script>
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">
	<!-- Modified by Yu-Hsuan Yen -->
<!-- math katex Header -->
<link href="https://cdn.bootcss.com/KaTeX/0.7.1/katex.min.css" rel="stylesheet">
<!-- Post Header -->
<style type="text/css">
    header.intro-header{
        
            background-image: url('/img/06.jpg')
            /*post*/
        
    }
    
</style>

<header class="intro-header" >
    <!-- Signature -->
    <div id="signature">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                
                    <div class="post-heading">
                        <div class="tags">
                            
                              <a class="tag" href="/tags/#android" title="android">android</a>
                            
                        </div>
                        <h1>chapter-01-getting-started</h1>
                        <h2 class="subheading"></h2>
                        <span class="meta">
                            Posted by allon li on
                            2016-02-22
                        </span>
                    </div>
                


                </div>
            </div>
        </div>
    </div>
</header>

	
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">李郞小汇</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">首页</a>
                    </li>

                    
                        
                        <li>
                            <a href="/about/">关于</a>
                        </li>
                        
                    
                        
                        <li>
                            <a href="/archive/">文章</a>
                        </li>
                        
                    
                        
                        <li>
                            <a href="/tags/">分类</a>
                        </li>
                        
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>


    <!-- Main Content -->
    <!-- Modify by Yu-Hsuan Yen -->

<!-- Post Content -->
<article class="at_img">
    <div class="container">
        <div class="row">

            <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <h1><span id="chapter-01-getting-started"> chapter-01-getting-started</span></h1>
<p>Tags: Training-for-Android-developers</p>
<hr>
<p>这是一个读 google的 android 教程的整理。仅以记录，不求误人。卽此而已。</p>
<h3><span id="关于-ide"> 关于 IDE</span></h3>
<p>欲善其事必利其器，在工具的对比和选择时间耗费整整用了一天。不过仍有磨刀不费砍柴功的感觉。直接上结论。</p>
<blockquote>
<ul>
<li>eclipse pass ,其因不再赘述。</li>
<li>IDEA + android support插件，和 android studio 是相同的代码 compile 出来的，只不过移植要慢一些。由于之前长期使用 idea，在上面有很多种类已经在用的代码插件，目前以来用它通吃了 python\scala\java\php。如果转到其他 IDE 势必会出现要使用两个 IDEA 的情况，不过在使用了一段时间 idea 打 android 插件的方式以后，发现对 android 开发的支持不太完备，用起来有些勉强。十分不情愿的放弃了它。 想说爱你不容易。</li>
<li>Android Studio 实际上是 IDEA的太监版，试着装了一些诸如 scala 语言的插件，几乎是不可用的。但是！我的目的现在是找一个好用的 IDE for Android。试了一下它的所有android 相关功能非常不错。更重要的是 google官方教程也使用的这款 IDE。</li>
<li>注（官网答复）： Android Studio and the Android plugin for IntelliJ IDEA are built from the same code, and all of the changes in Android Studio are, and will continue to be, available in IntelliJ IDEA releases.</li>
</ul>
</blockquote>
<h3><span id="gradle"> gradle</span></h3>
<p>android 程序和 java 程序一样也需要编译好后打包发布。在 java   中早期使用的 ant 比较多。后期逐步由 maven 做了大部分工作。和 ant、maven 一样。gradle 是一种相对较新的打包发布工具。目前在 android 中应用较多。主要是 android studio 使它。其实就是 ant 的升级版，完全兼容 ant 同时可以使用 groovy 和 scala 一些 jvm 平台上的其他语言做为配置语言。比使用 XML 灵活一些（然并卵！谁没事天天配这东西）。类似于 scala 里的 sbt ， nodejs 里的 npm 。<br>
有人写了一本书还不错：<br>
<a href="https://dongchuan.gitbooks.io/gradle-user-guide-/content/index.html" target="_blank" rel="noopener">https://dongchuan.gitbooks.io/gradle-user-guide-/content/index.html</a></p>
<p>最后，感觉对于 android 新人，完全没必要在这个上面浪费太多时间。现学现卖足矣。</p>
<hr>
<h2><span id="getting-started"> Getting Started</span></h2>
<p>新建一个 android 工程。</p>
<p>activity ，一个 android 界面就是一个activity。它需要一个布局配置。如下：</p>
<pre><code>app/src/main/res/layout/activity_my.xml
</code></pre>
<p>全局描述文件：</p>
<pre><code>app/src/main/AndroidManifest.xml
</code></pre>
<p>gradle 配置文件：</p>
<pre><code>app/build.gradle
</code></pre>
<p>values、layout、menu 目录：</p>
<pre><code>values 目录常放一些数字和字符串的值，就是一些存值的配置。类似于 properties 文件。另外两个见名知义。
</code></pre>
<h3><span id="activity及其四种状态"> Activity及其四种状态</span></h3>
<p>Activity启动模式设置：</p>
<pre><code>    &lt;activity android:name=&quot;.MainActivity&quot; android:launchMode=&quot;standard&quot; /&gt;
</code></pre>
<p>Activity的四种启动模式：</p>
<pre><code>1. standard

    默认启动模式，每次激活Activity时都会创建Activity，并放入任务栈中，永远不会调用onNewIntent()。

2. singleTop

    如果在任务的栈顶正好存在该Activity的实例， 就重用该实例，并调用其onNewIntent()，否者就会创建新的实例并放入栈顶(即使栈中已经存在该Activity实例，只要不在栈顶，都会创建实例，而不会调用onNewIntent()，此时就跟standard模式一样)。

3. singleTask

    如果在栈中已经有该Activity的实例，就重用该实例(会调用实例的onNewIntent())。重用时，会让该实例回到栈顶，因此在它上面的实例将会被移除栈。如果栈中不存在该实例，将会创建新的实例放入栈中（此时不会调用onNewIntent()）。 

4. singleInstance

    在一个新栈中创建该Activity实例，并让多个应用共享改栈中的该Activity实例。一旦改模式的Activity的实例存在于某个栈中，任何应用再激活改Activity时都会重用该栈中的实例，其效果相当于多个应用程序共享一个应用，不管谁激活该Activity都会进入同一个应用中。
</code></pre>
<h3><span id="运行和activity消息传递"> 运行和Activity消息传递</span></h3>
<ul>
<li>Andoird中有 View 和 ViewGroup 的概念。View 就是可见的控件，按钮啥的。类似一些GUI里的 Component ， ViewGroup类似一些语言 GUI 里的 Panel。</li>
<li>ViewGroup 是 View 容器而已。为了不使这些 View 散乱和更易管理。把许多 View 放在 ViewGroup  中集中调整它的布局等属性。</li>
</ul>
<p>wrap_content 根据控件文本等自适应大小。简单来讲：够用就得。<br>
match_parent 充满整个父容器边界。</p>
<h3><span id="权重"> 权重</span></h3>
<p><em>The weight value is a number that specifies the amount of remaining space each view should consume, relative to the amount consumed by sibling views. This works kind of like the amount of ingredients in a drink recipe: “2 parts soda, 1 part syrup” means two-thirds of the drink is soda. For example, if you give one view a weight of 2 and another one a weight of 1, the sum is 3, so the first view fills 2/3 of the remaining space and the second view fills the rest. If you add a third view and give it a weight of 1, then the first view (with weight of 2) now gets 1/2 the remaining space, while the remaining two each get 1/4.</em></p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">权重的值指的是每个部件所占剩余空间的大小，该值与同级部件所占空间大小有关。</span><br><span class="line">就类似于饮料的成分配方：“两份伏特加酒，一份咖啡利口酒”，即该酒中伏特加酒占三分之二</span><br><span class="line">。例如，我们设置一个View的权重是<span class="number">2</span>，另一个View的权重是<span class="number">1</span>，那么总数就是<span class="number">3</span>，这时第一个View占据<span class="number">2</span>/<span class="number">3</span>的空间，第二个占据<span class="number">1</span>/<span class="number">3</span>的空间。如果你再加入第三个View，权重设为<span class="number">1</span>，那么第一个View(权重为<span class="number">2</span>的)会占据<span class="number">1</span>/<span class="number">2</span>的空间，剩余的另外两个View各占<span class="number">1</span>/<span class="number">4</span>。(请注意，使用权重的前提一般是给View的宽或者高的大小设置为<span class="number">0</span>dp，然后系统根据上面的权重规则来计算View应该占据的空间。</span><br><span class="line">但是很多情况下，如果给View设置了match_parent的属性，那么上面计算权重时则不是通常的正比，而是反比，也就是权重值大的反而占据空间小)。</span><br><span class="line">对于所有的View默认的权重是<span class="number">0</span>，如果只设置了一个View的权重大于<span class="number">0</span>，则该View将占据除去别的View本身占据的空间的所有剩余空间。</span><br><span class="line">因此这里设置EditText的权重为<span class="number">1</span>，使其能够占据除了按钮之外的所有空间。</span><br><span class="line">目前全中仅被用在LinearLayout中。</span><br></pre></td></tr></table></figure>
<p><strong>总结：权值PK，此消彼长。</strong></p>
<h3><span id="activity-间传递及拉起"> Activity 间传递及拉起</span></h3>
<p>两个界面 （Activity） 之间如果要传值或者一个拉起另一个的操作，都需要 Intent做为媒介（哪怕不传值，只是拉起下游 Activity 也要使用 Intet 源码中这里没有任何处理，只要你不传它就报 NPE）。Intent 特别类似于网络请求中的 Request 对象，如果服务端没接到 Request 对象，后面的业务也不会被拉起。同样的像 Request 一样，Intent 也可以做为信息传递的载体，putExtra方法和 Request 中的 setAttribute 一样。用 K-&gt;V 的方式存储信息。</p>
<hr>
<h2><span id="适配"> 适配</span></h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//判断指定版本下才可以运行，柔性可用</span></span><br><span class="line"><span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.HONEYCOMB) &#123;</span><br><span class="line">    ActionBar actionBar = getActionBar();</span><br><span class="line">    actionBar.setDisplayHomeAsUpEnabled(<span class="keyword">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>有4种普遍尺寸：小(small)，普通(normal)，大(large)，超大(xlarge)</li>
<li>4种普遍分辨率：低精度(ldpi), 中精度(mdpi), 高精度(hdpi), 超高精度(xhdpi)</li>
</ul>
<p><strong>layout\国际化(语言)\图片 这些差别都是用目录来区分的。系统会根据设置或者默认拉起对应的配置。</strong></p>
<h2><span id="activity-的生命周期"> Activity 的生命周期</span></h2>
<p><img src="http://developer.android.com/images/training/basics/basic-lifecycle-paused.png" alt="图1"></p>
<p>上图显示：当用户离开我们的activity时，系统会调用onStop()来停止activity (1). 这个时候如果用户返回，系统会调用onRestart()(2), 之后会迅速调用onStart()(3)与onResume()(4). 请注意：无论什么原因导致activity停止，系统总是会在onStop()之前调用onPause()方法。</p>
<ul>
<li>onResume: 初始化操作一般在这里做，onCreate 不要初始化太多东西，不然打开应用会很久看不到界面。</li>
<li>onStop: 当 activity 隐藏以后要执行的heavy-load操作一般会在 onStop 中。不要把heavy-load操作放到 onPasue 这样会影响界面切换速度。写 DB 建议在此方法中实现，任何heavy-load操作再生命周期中执行，要多考虑异步执行，否则容易引起主线程假死。</li>
</ul>
<p>几种会调用onDestroy的情况:</p>
<blockquote>
<ul>
<li>用户点击 back 按钮</li>
<li>程序里调用了 finish() 方法</li>
<li>资源紧张时（后台长期 stop 状态或者前台需要更多内存），系统可能会干掉它。系统在 destroy 时把现场存到一个 Bundle 对象中的键值对中(instance state)，当用户要回到这个 Activity 时，系统会重建一个 Activity 实例（此 Activity 已是物是人非，非彼 Activity!）</li>
<li>Activity 会在每次旋转屏幕时被 destroyed 与 recreated 。当屏幕改变方向时，系统会 Destory 与 Recreate 前台的 activity ，因为屏幕配置被改变，Activity 可能需要加载另一些替代的资源(例如layout)。为了让所有信息顺利</li>
</ul>
</blockquote>
<p><img src="http://developer.android.com/images/training/basics/basic-lifecycle-savestate.png" alt="图2"></p>
<p><strong>调用 onSaveInstanceState 的时机：</strong><br>
onSaveInstanceState()的调用遵循一个重要原则，即当系统存在“未经你许可”时销毁了我们的activity的<strong>可能</strong>时，则onSaveInstanceState()<strong>可能</strong>会被系统调用，这是系统的责任，因为它必须要提供一个机会让你保存你的数据（当然你不保存那就随便你了）。如果调用，调用将发生在onPause()之后、onStop()方法之前。注：如果你kill或者kill -9，系统都不会调用此方法，因为它没机会执行就被干掉了，做不到。<br>
　<br>
以下情况都仅仅是可能会触发该方法的，</p>
<blockquote>
<ul>
<li>用户按下HOME键时。</li>
<li>长按HOME键，选择运行其他的程序时。</li>
<li>按下电源按键（关闭屏幕显示）时。</li>
<li>从activity A中启动一个新的activity时。</li>
<li>屏幕方向切换时，例如从竖屏切换到横屏时。</li>
</ul>
</blockquote>
<p><strong>调用 onRestoreInstanceState 的时机：</strong><br>
只有在Activity真的被系统非正常干掉过，恢复显示Activity的时候，才会调用onRestoreInstanceState。</p>
<h2><span id="fragments"> Fragments</span></h2>
<p><img src="http://developer.android.com/images/fundamentals/fragments.png" alt="图3"></p>
<p>Fragment是为了activity的模块化而出现的概念，它拥有自己的生命周期，接收自己的输入事件，可以在acvitity运行过程中添加或者移除（有点像&quot;子activity&quot;，可以在不同的activity里面重复使用，当通过XML布局文件的方式将Fragment添加进activity时，Fragment是不能被动态移除的。如果想要在用户交互的时候把fragment切入与切出，必须在activity启动后，再将fragment添加进activity。）。</p>
<p><img src="http://developer.android.com/images/fragment_lifecycle.png" alt="图4"></p>
<ul>
<li>
<p>为了执行fragment的增加或者移除操作，必须通过 FragmentManager 创建一个FragmentTransaction对象,FragmentTransaction提供了用来增加、移除、替换以及其它一些操作的APIs。</p>
</li>
<li>
<p>如果我们的activity允许fragment移除或者替换，我们应该在activity的onCreate()方法中添加初始化fragment(s).</p>
</li>
<li>
<p>fragment其实只是一个虚拟的框，它里面不装东西它就什么也不是。所以必须有一个View把它撑起来（inflate）。</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">inflater.inflate(R.layout.article_view, container, <span class="keyword">false</span>);</span><br></pre></td></tr></table></figure>
<p>移除或者替换Fragment，如果要适当地让用户可以向后导航与&quot;撤销&quot;这次改变。为了让用户向后导航fragment事务，我们必须在FragmentTransaction提交前调用addToBackStack()方法。（如果不加到栈顶，点返回键栈里没东西时，会直接返回到桌面）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">transaction.addToBackStack(<span class="keyword">null</span>);</span><br></pre></td></tr></table></figure>
<h2><span id="数据持久化"> 数据持久化</span></h2>
<p>为了能方便这里的实验，手机root以后。可以用以下两种方式查看系统文件：</p>
<blockquote>
<ul>
<li>手机连usb后将android sdk的platform加到PATH中，执行adb shell，su - root。就可以切到root下，为所欲为（君子有所为有所不为）。</li>
<li>也可以在手机端安装一个ssh server软件（如：SSHDriodPro）,启动服务，在确认软件拿到root权限同时pc和手机在相同网段后，pc上使用ssh root@[ip] -p [port]连上，再su - root。效果同上。</li>
</ul>
</blockquote>
<h3><span id="保存到preference"> 保存到Preference</span></h3>
<p>preference有些类似cookie。每个Prefernece文件就是存一些k-&gt;v。</p>
<ul>
<li>getSharedPreferences() 可以取多个带名文件，当文件不存在的时间，get时会自动创建。</li>
<li>getPreference() 不需要名，只取一个文件。</li>
<li>当写文件时，Preference的Editor对象要commit一下才会生效。</li>
</ul>
<blockquote>
<p>当我们用root登录到手机上，cd /data/data/com.example.android.fragments/ (包名根据具体app配置决定)，之后我们能看到一个叫shared_prefs文件夹。<br>
进入这个文件夹后看到：MainActivity.xml和preference_file_key.xml。</p>
</blockquote>
<p>单个文件，无需指定文件名方式</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--MainActivity.xml--&gt;</span></span><br><span class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">'1.0'</span> encoding=<span class="string">'utf-8'</span> standalone=<span class="string">'yes'</span> <span class="meta">?&gt;</span></span></span><br><span class="line"><span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">"preference"</span>&gt;</span>preference1<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>自己指定文件名来存储</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--preference_file_key.xml--&gt;</span></span><br><span class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">'1.0'</span> encoding=<span class="string">'utf-8'</span> standalone=<span class="string">'yes'</span> <span class="meta">?&gt;</span></span></span><br><span class="line"><span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">"sharedPref"</span>&gt;</span>SharedPreferences1<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>再对比一下代码，司马昭之心路人皆知：<em><strong>所谓的Preference就是一个xml文件而已</strong></em></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveData</span><span class="params">()</span></span>&#123;</span><br><span class="line">    SharedPreferences sharedPref = getSharedPreferences();</span><br><span class="line">    SharedPreferences preference = getPreference();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (sharedPref.getString(<span class="string">"sharedPref"</span>, <span class="keyword">null</span>) == <span class="keyword">null</span>) &#123;</span><br><span class="line">        SharedPreferences.Editor editor = sharedPref.edit();</span><br><span class="line">        editor.putString(<span class="string">"sharedPref"</span>, <span class="string">"SharedPreferences1"</span>);</span><br><span class="line">        editor.commit();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (preference.getString(<span class="string">"preference"</span>, <span class="keyword">null</span>) == <span class="keyword">null</span>) &#123;</span><br><span class="line">        SharedPreferences.Editor editor = preference.edit();</span><br><span class="line">        editor.putString(<span class="string">"preference"</span>, <span class="string">"preference1"</span>);</span><br><span class="line">        editor.commit();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取preferences</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> SharedPreferences <span class="title">getSharedPreferences</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> getActivity().getSharedPreferences(getString(R.string.preference_file_key), Context.MODE_PRIVATE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取单个文件</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> SharedPreferences <span class="title">getPreference</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> getActivity().getPreferences(Context.MODE_PRIVATE);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3><span id="存文件"> 存文件</span></h3>
<p>也可以直接操作文件来读写，分为External和Internal两种文件操作。使用的API都是java操作文件IO的标准API。当写完文件以后，可以用adb在上面提到的shared_prefs同级目录中查看到一个files和caches目录分别存储用来存普通文件和临时文件。<br>
写文件不仅可以写到应用/data/data/package_name/files/下，还可以写到外部存储路径，即sdcard中。</p>
<blockquote>
<p>在写入文件时，目录是可以指定的。但是一般情况下的权限只能指定自己app所对应的目录。其他程序目录如果强制被chmod授权，当前程序也可以写到那个目录，或者当前程序拿到root权限也可随便写。</p>
</blockquote>
<h3><span id="写db"> 写DB</span></h3>
<p>Android的自带DB规范是sqlite。操作和java中的一些操作DB方式基本相同。DB文件存在/data/data/[应用]/databases下。可以使用sqlite3命令查看。如果手机上没有安装，可以从模拟器中pull出来，再push到手机上。前提是手机得root。</p>
<p>搞定以后直接sqlite3 xxx.db。然后sql语句就ok.</p>
<blockquote>
<p>在调试过程中，经常会有查询DB中的数据需要。除了命令行，也可以使用一个sqlite editor pro的软件。它可以帮你搜索整个手机中的DB数据，直观查看。</p>
</blockquote>
<p>查询</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//要查哪些列</span></span><br><span class="line">String[] projection = &#123;</span><br><span class="line">        FeedReaderContract.FeedEntry._ID,</span><br><span class="line">        FeedReaderContract.FeedEntry.COLUMN_NAME_TITLE</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//排序参数，也可以加各种where</span></span><br><span class="line">String sortOrder = FeedReaderContract.FeedEntry._ID + <span class="string">" DESC"</span>;</span><br><span class="line"><span class="comment">//拿到游标</span></span><br><span class="line">Cursor cursor = db.query(</span><br><span class="line">        FeedReaderContract.FeedEntry.TABLE_NAME,  <span class="comment">// The table to query</span></span><br><span class="line">        projection,                               <span class="comment">// The columns to return</span></span><br><span class="line">        <span class="keyword">null</span>,                                <span class="comment">// The columns for the WHERE clause</span></span><br><span class="line">        <span class="keyword">null</span>,                            <span class="comment">// The values for the WHERE clause</span></span><br><span class="line">        <span class="keyword">null</span>,                                     <span class="comment">// don't group the rows</span></span><br><span class="line">        <span class="keyword">null</span>,                                     <span class="comment">// don't filter by row groups</span></span><br><span class="line">        sortOrder                                 <span class="comment">// The sort order</span></span><br><span class="line">);</span><br><span class="line"><span class="comment">//移到头</span></span><br><span class="line">cursor.moveToFirst();</span><br><span class="line"><span class="comment">//一般于用do while，判断isLast，然后moveToNext。相当于jdbc中的rs.next()。</span></span><br><span class="line">cursor.moveToNext();</span><br></pre></td></tr></table></figure>
<p>写</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ContentValues values = <span class="keyword">new</span> ContentValues();</span><br><span class="line">values.put(FeedReaderContract.FeedEntry.COLUMN_NAME_ENTRY_ID, i);</span><br><span class="line">values.put(FeedReaderContract.FeedEntry.COLUMN_NAME_TITLE, <span class="string">"title"</span> + i);</span><br><span class="line"></span><br><span class="line"><span class="keyword">long</span> newRowId = db.insert(FeedReaderContract.FeedEntry.TABLE_NAME, <span class="keyword">null</span>, values);</span><br><span class="line"></span><br><span class="line">list.add(newRowId);</span><br></pre></td></tr></table></figure>
<p>删除</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.delete</span><br></pre></td></tr></table></figure>
<p>更新</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.update</span><br></pre></td></tr></table></figure>

                

                <hr>
                <!-- Pager -->
                <ul class="pager">
                    
                        <li class="previous">
                            <a href="/2017/11/21/线性代数/" data-toggle="tooltip" data-placement="top" title="线性代数这点事">&larr; 上一篇</a>
                        </li>
                    
                    
                        <li class="next">
                            <a href="/2016/02/22/chapter-02-sharing-and-multimedia/" data-toggle="tooltip" data-placement="top" title="chapter-02-sharing-and-multimedia">下一篇 &rarr;</a>
                        </li>
                    
                </ul>

                <!-- duoshuo Share start -->
                
                <!-- 多说 Share end-->

                <!-- 多说评论框 start -->
                
                <!-- 多说评论框 end -->

                <!-- disqus comment start -->
                
                <!-- disqus comment end -->
            </div>
            
            <!-- Tabe of Content -->
            <!-- Table of Contents -->

    
      <aside id="sidebar">
        <div id="toc" class="toc-article">
        <strong class="toc-title">Contents</strong>
        
          <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.</span> <span class="toc-nav-text"> chapter-01-getting-started</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.0.1.</span> <span class="toc-nav-text"> 关于 IDE</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.0.2.</span> <span class="toc-nav-text"> gradle</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.1.</span> <span class="toc-nav-text"> Getting Started</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.1.1.</span> <span class="toc-nav-text"> Activity及其四种状态</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.1.2.</span> <span class="toc-nav-text"> 运行和Activity消息传递</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.1.3.</span> <span class="toc-nav-text"> 权重</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.1.4.</span> <span class="toc-nav-text"> Activity 间传递及拉起</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.2.</span> <span class="toc-nav-text"> 适配</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.3.</span> <span class="toc-nav-text"> Activity 的生命周期</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.4.</span> <span class="toc-nav-text"> Fragments</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.5.</span> <span class="toc-nav-text"> 数据持久化</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.5.1.</span> <span class="toc-nav-text"> 保存到Preference</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.5.2.</span> <span class="toc-nav-text"> 存文件</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.5.3.</span> <span class="toc-nav-text"> 写DB</span></a></li></ol></li></ol></li></ol>
        
        </div>
      </aside>
    

                
            <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <!-- no hr -->
                    <h5><a href="/tags/">分类</a></h5>
                    <div class="tags">
                       
                          <a class="tag" href="/tags/#android" title="android">android</a>
                        
                    </div>
                </section>
                

                <!-- Friends Blog -->
                
                <hr>
                <h5>友情链接</h5>
                <ul class="list-inline">

                    
                        <li><a href="https://allonli.github.io" target="_blank">blogs</a></li>
                    
                        <li><a href="http://www.allonli.com" target="_blank">allonli.com</a></li>
                    
                </ul>
                
            </div>
        </div>
    </div>
</article>





<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("https://cdn.bootcss.com/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'hover',
          placement: 'left',
          icon: 'ℬ'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>




    <!-- Footer -->
    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                
                
                
                    <li>
                        <a target="_blank" href="https://www.zhihu.com/people/allon">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa  fa-stack-1x fa-inverse">知</i>
                            </span>
                        </a>
                    </li>
                

                

                
                    <li>
                        <a target="_blank" href="https://www.facebook.com/allon517">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                
                    <li>
                        <a target="_blank"  href="https://github.com/allonli">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                

                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; allon li 2017 
                    <br>
                    Theme by <a href="http://huangxuan.me">Hux</a> 
                    <span style="display: inline-block; margin: 0 5px;">
                        <i class="fa fa-heart"></i>
                    </span> 
                    re-Ported by <a href="http://beantech.org">BeanTech</a> | 
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="91px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=YenYuHsuan&repo=hexo-theme-beantech&type=star&count=true" >
                    </iframe>
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js"></script>

<!-- Custom Theme JavaScript -->
<script src="/js/hux-blog.min.js"></script>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- 
     Because of the native support for backtick-style fenced code blocks 
     right within the Markdown is landed in Github Pages, 
     From V1.6, There is no need for Highlight.js, 
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0  
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/    
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->


<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("http://www.allonli.com/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->


<script>
    // dynamic User by Hux
    var _gaId = 'UA-XXXXXXXX-X';
    var _gaDomain = 'www.allonli.com';

    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>




<!-- Baidu Tongji -->




	<a id="rocket" href="#top" class=""></a>
	<script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
    <script type="text/javascript" src="/js/toc.js?v=1.0.0" async=""></script>
<!-- Image to hack wechat -->
<img src="http://www.allonli.com/img/icon_wechat.png" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
